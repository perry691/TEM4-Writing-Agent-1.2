<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>TEM-4 Writing Agentï¼ˆæ”¯æŒè¿½é—®ï¼‰</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  :root{
    --bg:#f0f8ff;
    --card:#fff;
    --primary:#0077ff;
    --primary-dark:#0059d1;
    --radius:12px;
    --shadow:0 8px 32px rgba(0,0,0,.08);
    --font:"SF Pro","Segoe UI",Helvetica,Arial,sans-serif;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);font-family:var(--font);color:#333;line-height:1.6}
  header{background:#004e92;color:#fff;padding:1rem 2rem;font-size:1.3rem;font-weight:bold}
  .wrap{max-width:900px;margin:2rem auto;background:var(--card);border-radius:16px;box-shadow:var(--shadow);overflow:hidden}
  .pad{padding:2rem 2.5rem}
  textarea{width:100%;min-height:160px;font-size:16px;padding:14px;border:1px solid #d0d7de;border-radius:var(--radius);resize:vertical}
  .btn-group{display:flex;gap:.75rem;margin-top:1.5rem}
  button{
    flex:1;
    cursor:pointer;
    font-size:16px;
    font-weight:600;
    color:#fff;
    background:linear-gradient(145deg,var(--primary),var(--primary-dark));
    border:none;
    border-radius:20px;
    padding:10px 24px;
    box-shadow:0 4px 12px rgba(0,0,0,.25),inset 0 1px 0 rgba(255,255,255,.3);
    transition:transform .1s,box-shadow .1s;
  }
  button:active{transform:translateY(2px);box-shadow:0 2px 6px rgba(0,0,0,.35)}
  table{border-collapse:collapse;width:100%;margin-top:1rem}
  th,td{border:1px solid #e0e0e0;padding:.7rem;text-align:center}
  th{background:#f7f7f7}
  .score{font-size:1.3rem;font-weight:bold;color:#0a47ff}
  .hidden{display:none}
  #followQ{margin-top:1.5rem}
  .q-chip{
    display:inline-block;
    margin:.25rem;
    padding:.5rem .75rem;
    background:#e7f3ff;
    border-radius:var(--radius);
    font-size:.9rem;
    cursor:pointer;
  }
  footer{text-align:center;padding:1rem 0;font-size:14px;color:#666;background:var(--bg)}
</style>
</head>
<body>

<header>TEM-4 Writing Agentï¼ˆæ”¯æŒè¿½é—®ï¼‰</header>

<div class="wrap">
  <div class="pad">
    <label>å†™ä½œé¢˜ç›® (Task):</label>
    <textarea id="taskInput" placeholder="è¯·æŠŠé¢˜ç›®ç²˜è´´è¿›æ¥â€¦â€¦"></textarea>

    <label style="margin-top:1rem;display:block">å­¦ç”Ÿä½œæ–‡ (Essay):</label>
    <textarea id="essayInput" placeholder="è¯·æŠŠä½œæ–‡ç²˜è´´è¿›æ¥â€¦â€¦"></textarea>

    <div class="btn-group">
      <button onclick="resetPage()">é‡ç½®</button>
      <button onclick="evaluateEssay()">å¼€å§‹æ‰¹æ”¹</button>
      <button onclick="window.print()">å¯¼å‡º PDF</button>
    </div>
  </div>

  <!-- æ‰¹æ”¹ç»“æœ -->
  <div id="resultArea" class="pad hidden">
    <h2>æ‰¹æ”¹ç»“æœ</h2>
    <p><strong>æ€»åˆ†ï¼š<span id="totalScore" class="score">--</span>/20</strong>ï¼ˆ<span id="level">--</span>ï¼‰</p>
    <table>
      <thead>
        <tr><th>ç»´åº¦</th><th>æ»¡åˆ†</th><th>å¾—åˆ†</th><th>è¯„è¯­</th></tr>
      </thead>
      <tbody id="detailTable"></tbody>
    </table>
    <h3>é€æ®µç‚¹è¯„ & ä¿®æ”¹å»ºè®®</h3>
    <div id="detailedComments"></div>
    <h3>é«˜åˆ†æ›¿æ¢è¡¨è¾¾</h3>
    <ul id="wordUpgrade"></ul>
  </div>

  <!-- è¿½é—®åŒºåŸŸ -->
  <div id="followQ" class="pad hidden">
    <h3>ğŸ¤” ç»§ç»­è¿½é—®</h3>
    <p>ç‚¹å‡»ä¸‹æ–¹é—®é¢˜å³å¯å¿«é€Ÿè¿½é—®ï¼š</p>
    <div id="qList"></div>
    <div id="followAnswer" style="margin-top:1rem;"></div>
  </div>
</div>

<footer>
  Powered by GitHub. Copyright@PERRY.
</footer>

<script>
/* ---------- è¯„åˆ†ç»´åº¦ ---------- */
const rubric = [
  {dim:"å†…å®¹é˜è¿°èƒ½åŠ›", full:10, desc:"å‡†ç¡®è¡¨è¿°ææ–™ä¸»é¢˜ã€ä¸­å¿ƒå†…å®¹ä¸è¦ç‚¹ï¼›è®¨è®ºåˆ‡é¢˜ï¼Œè§‚ç‚¹æ˜ç¡®ï¼Œè®ºæ®å……åˆ†"},
  {dim:"ç¯‡ç« ç»„ç»‡èƒ½åŠ›", full:3,  desc:"æ®µè½åˆ’åˆ†åˆç†ï¼Œè¡”æ¥è‡ªç„¶ï¼Œç¯‡å¹…åˆé€‚"},
  {dim:"è¯­è¨€è¿ç”¨èƒ½åŠ›", full:7,  desc:"è¯æ±‡å‡†ç¡®ä¸°å¯Œï¼Œè¯­æ³•æ­£ç¡®ï¼Œå¥å¼å¤šæ ·ï¼Œä¹¦å†™è§„èŒƒ"}
];

/* ---------- è¿½é—®é¢˜åº“ ---------- */
const followQuestions = [
  "å¦‚ä½•è¿›ä¸€æ­¥ä¸°å¯Œè®ºæ®ï¼Ÿ",
  "å¦‚ä½•ä¼˜åŒ–è¿‡æ¸¡è¡”æ¥ï¼Ÿ",
  "è¯·æŒ‡å‡ºæœ€çªå‡ºçš„è¯­æ³•é—®é¢˜åŠä¿®æ”¹ã€‚",
  "èƒ½å¦ç»™å‡ºä¸‰ä¸ªé«˜åˆ†å¥å¼æ›¿æ¢ï¼Ÿ"
];

/* ---------- è¿½é—®ç­”æ¡ˆ ---------- */
const followAnswers = {
  "å¦‚ä½•è¿›ä¸€æ­¥ä¸°å¯Œè®ºæ®ï¼Ÿ":"å¯åŠ å…¥æ•°æ®ã€åè¨€ã€å®ä¾‹æˆ–å¯¹æ¯”è®ºè¯ï¼Œä½¿è®ºç‚¹æ›´å…·è¯´æœåŠ›ã€‚",
  "å¦‚ä½•ä¼˜åŒ–è¿‡æ¸¡è¡”æ¥ï¼Ÿ":"åˆç†ä½¿ç”¨è¿æ¥è¯ï¼šFirstly, Moreover, Furthermore, In conclusion ç­‰ï¼Œå¹¶æ³¨æ„ä»£è¯å›æŒ‡ã€‚",
  "è¯·æŒ‡å‡ºæœ€çªå‡ºçš„è¯­æ³•é—®é¢˜åŠä¿®æ”¹ã€‚":"å¸¸è§é—®é¢˜ï¼šä¸»è°“ä¸€è‡´ã€æ—¶æ€æ··ä¹±ã€å† è¯ç¼ºå¤±ã€‚å·²åœ¨ä¸Šæ–‡é€æ®µæ ‡æ³¨ï¼Œè¯·é‡ç‚¹æ ¸å¯¹ã€‚",
  "èƒ½å¦ç»™å‡ºä¸‰ä¸ªé«˜åˆ†å¥å¼æ›¿æ¢ï¼Ÿ":"1.Not only...but also... 2.Hardly...when... 3.So...that...ï¼ˆå·²åœ¨ä¸Šæ–‡æ›¿æ¢åŒºåˆ—å‡ºï¼‰"
};

/* ---------- æ‰¹æ”¹ä¸»å‡½æ•° ---------- */
function evaluateEssay(){
  const task = document.getElementById('taskInput').value.trim();
  const essay = document.getElementById('essayInput').value.trim();
  if(!task || !essay){ alert("è¯·å…ˆå¡«å†™é¢˜ç›®ä¸ä½œæ–‡ï¼"); return; }

  const wc = essay.split(/\s+/).filter(Boolean).length;
  const res = runEvaluation(task, essay, wc);
  renderResult(res, wc);

  /* æ˜¾ç¤ºè¿½é—®æŒ‰é’® */
  const qHtml = followQuestions.map(q=>`<span class="q-chip" onclick="showAnswer('${q}')">${q}</span>`).join('');
  document.getElementById('qList').innerHTML = qHtml;
  document.getElementById('followQ').classList.remove('hidden');
}

function runEvaluation(task, essay, wc){
  let c10 = 6, o3 = 2, l7 = 5;

  if(/for example|such as|first|second/i.test(essay)) c10 += 2;
  if(wc >= 150 && essay.split(/\n+/).filter(p=>p.trim()).length >= 3) c10 += 2;
  c10 = Math.min(10, c10);

  const paraCnt = essay.split(/\n+/).filter(p=>p.trim()).length;
  o3 = (paraCnt >= 3 && wc >= 150) ? 3 : (paraCnt >= 2 ? 2 : 1);

  const typo = (essay.match(/(teh|recieve|alot)/gi) || []).length;
  if(typo === 0) l7 += 1;
  if((essay.match(/\. [A-Z]/g) || []).length > 5) l7 += 1;
  l7 = Math.min(7, l7);

  const total = c10 + o3 + l7;
  const level = total>=18?"ä¸€æ¡£ (ä¼˜ç§€)":total>=15?"äºŒæ¡£ (è‰¯å¥½)":total>=12?"ä¸‰æ¡£ (å°šå¯)":total>=9?"å››æ¡£ (é—®é¢˜)":"äº”æ¡£ (å¤±è´¥)";

  const paras = essay.split(/\n+/).filter(p=>p.trim());
  const comments = paras.map((p,i)=>{
    let c="";
    if(p.split(/\s+/).length<20) c+="æ®µè½ç•¥çŸ­ï¼›";
    if(!/[.!?]$/.test(p.trim())) c+="å¥æœ«ç¼ºå°‘æ ‡ç‚¹ï¼›";
    return `<li><strong>æ®µ${i+1}ï¼š</strong>${p}<br><span style="color:#c62828">${c||"æ®µè½ç»“æ„è¾ƒå¥½ã€‚"}</span></li>`;
  }).join("");

  const upgrades = {
    "very important":"crucial / essential",
    "good":"beneficial / rewarding",
    "help":"facilitate / assist",
    "learn from each other":"mutual learning"
  };
  const upgradeList = Object.entries(upgrades).map(([k,v])=>`<li><strong>${k}</strong> â†’ ${v}</li>`).join("");

  return {scores:[c10, o3, l7], total, level, comments, upgradeList};
}

function renderResult(r, wc){
  document.getElementById('totalScore').textContent = r.total;
  document.getElementById('level').textContent = r.level;

  const tbody = document.getElementById('detailTable');
  tbody.innerHTML = "";
  rubric.forEach((item,i)=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${item.dim}</td><td>${item.full}</td><td>${r.scores[i]}</td><td>${item.desc}</td>`;
    tbody.appendChild(tr);
  });

  document.getElementById('detailedComments').innerHTML = `<p><strong>å­—æ•°ï¼š</strong>${wc} words</p><ul>${r.comments}</ul>`;
  document.getElementById('wordUpgrade').innerHTML = r.upgradeList;
  document.getElementById('resultArea').classList.remove('hidden');
}

/* ---------- è¿½é—®äº¤äº’ ---------- */
function showAnswer(q){
  document.getElementById('followAnswer').innerHTML = `<p><strong>è¿½é—®ï¼š</strong>${q}<br><strong>å›ç­”ï¼š</strong>${followAnswers[q]}</p>`;
}

/* ---------- é‡ç½® ---------- */
function resetPage(){
  document.getElementById('taskInput').value='';
  document.getElementById('essayInput').value='';
  document.getElementById('resultArea').classList.add('hidden');
  document.getElementById('followQ').classList.add('hidden');
}
</script>
</body>
</html>